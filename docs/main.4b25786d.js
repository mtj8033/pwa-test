parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"QGXO":[function(require,module,exports) {
"use strict";function e(){if("serviceWorker"in navigator){var e;window.addEventListener("load",function(){navigator.serviceWorker.register("/pwa-test/sw.js").then(function(e){console.log("Registration succeeded")}).catch(function(e){console.log("Registration failed with error",e)})});var t=document.querySelector(".installButton");window.addEventListener("beforeinstallprompt",function(o){o.preventDefault(),console.log("before install event received"),window.matchMedia("(display-mode: standalone)").matches||(e=o,t.classList.toggle("is-visible"))}),t.addEventListener("click",function(o){t.classList.toggle("is-visible"),e.prompt(),e.userChoice.then(function(t){"accepted"===t.outcome?(console.log("User accepted the A2HS prompt"),e=null):console.log("User dismissed the A2HS prompt")})})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.setupServiceWorker=e;
},{"./sw.js":[["sw.js","NqYy"],"sw.js.map","NqYy"]}],"pNKq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.a=I,exports.b=v,exports.e=exports.d=exports.c=void 0;const e=(e,t)=>t.some(t=>e instanceof t);let t,r;function n(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function o(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}exports.c=e;const s=new WeakMap,a=new WeakMap,i=new WeakMap,c=new WeakMap,u=new WeakMap;function p(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(I(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}),u.set(t,e),t}function f(e){if(a.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),n()},s=()=>{r(e.error),n()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});a.set(e,t)}exports.d=u;let d={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||i.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return I(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){d=e(d)}function D(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?o().includes(e)?function(...t){return e.apply(B(this),t),I(s.get(this))}:function(...t){return I(e.apply(B(this),t))}:function(t,...r){const n=e.call(B(this),t,...r);return i.set(n,t.sort?t.sort():[t]),I(n)}}function m(t){return"function"==typeof t?D(t):(t instanceof IDBTransaction&&f(t),e(t,n())?new Proxy(t,d):t)}function I(e){if(e instanceof IDBRequest)return p(e);if(c.has(e))return c.get(e);const t=m(e);return t!==e&&(c.set(e,t),u.set(t,e)),t}const B=e=>u.get(e);exports.e=B;
},{}],"sI9i":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.openDB=t,exports.deleteDB=n,Object.defineProperty(exports,"unwrap",{enumerable:!0,get:function(){return e.e}}),Object.defineProperty(exports,"wrap",{enumerable:!0,get:function(){return e.a}});var e=require("./chunk.js");function t(t,n,{blocked:r,upgrade:o,blocking:a}={}){const s=indexedDB.open(t,n),d=(0,e.a)(s);return o&&s.addEventListener("upgradeneeded",t=>{o((0,e.a)(s.result),t.oldVersion,t.newVersion,(0,e.a)(s.transaction))}),r&&s.addEventListener("blocked",()=>r()),a&&d.then(e=>e.addEventListener("versionchange",a)),d}function n(t,{blocked:n}={}){const r=indexedDB.deleteDatabase(t);return n&&r.addEventListener("blocked",()=>n()),(0,e.a)(r).then(()=>void 0)}const r=["get","getKey","getAll","getAllKeys","count"],o=["put","add","delete","clear"],a=new Map;function s(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(a.get(t))return a.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,d=o.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!d&&!r.includes(n))return;const i=async function(e,...t){const r=this.transaction(e,d?"readwrite":"readonly");let o=r.store;s&&(o=o.index(t.shift()));const a=o[n](...t);return d&&await r.done,a};return a.set(t,i),i}(0,e.b)(e=>({get:(t,n,r)=>s(t,n)||e.get(t,n,r),has:(t,n)=>!!s(t,n)||e.has(t,n)}));
},{"./chunk.js":"pNKq"}],"kJfG":[function(require,module,exports) {
"use strict";var e=require("./chunk.js");const t=["continue","continuePrimaryKey","advance"],n={},r=new WeakMap,i=new WeakMap,s={get(e,s){if(!t.includes(s))return e[s];let a=n[s];return a||(a=n[s]=function(...e){r.set(this,i.get(this)[s](...e))}),a}};async function*a(...t){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...t)),!n)return;n=n;const a=new Proxy(n,s);for(i.set(a,n),e.d.set(a,(0,e.e)(n));n;)yield a,n=await(r.get(a)||n.continue()),r.delete(a)}function c(t,n){return n===Symbol.asyncIterator&&(0,e.c)(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&(0,e.c)(t,[IDBIndex,IDBObjectStore])}(0,e.b)(e=>({get:(t,n,r)=>c(t,n)?a:e.get(t,n,r),has:(t,n)=>c(t,n)||e.has(t,n)}));
},{"./chunk.js":"pNKq"}],"nw8M":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./build/esm/index.js");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}})}),require("./build/esm/async-iterators.js");
},{"./build/esm/index.js":"sI9i","./build/esm/async-iterators.js":"kJfG"}],"wN2b":[function(require,module,exports) {
"use strict";var e=/["'&<>]/;function r(r){var a,t=""+r,s=e.exec(t);if(!s)return t;var c="",n=0,u=0;for(n=s.index;n<t.length;n++){switch(t.charCodeAt(n)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 39:a="&#39;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}u!==n&&(c+=t.substring(u,n)),u=n+1,c+=a}return u!==n?c+t.substring(u,n):c}module.exports=r;
},{}],"uD46":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setupIndexedDB=v;var e=require("idb/with-async-ittr"),t=n(require("escape-html"));function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return c(e)||o(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function c(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function s(e,t,n,r,a,o,c){try{var s=e[o](c),u=s.value}catch(i){return void n(i)}s.done?t(u):Promise.resolve(u).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function c(e){s(o,r,a,c,u,"next",e)}function u(e){s(o,r,a,c,u,"throw",e)}c(void 0)})}}function i(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}var l=v(),d=document.querySelector(".new-todo"),p=document.querySelector(".todo-list"),f=new Headers({"Content-Type":"application/json; charset=UTF-8"}),h="//jsonplaceholder.typicode.com/todos";function v(){return"indexedDB"in window?(0,e.openDB)("pwa-test-db",4,{upgrade:function(e,t,n,r){var a;console.log(t,n),a=e.objectStoreNames.contains("todos")?r.objectStore("todos"):e.createObjectStore("todos"),t<2&&a.createIndex("localKey","localKey",{unique:!0}),t<3&&a.createIndex("idLocal",["id","localKey"],{unique:!0}),t<4&&a.deleteIndex("idLocal")}}):null}function y(){d.addEventListener("change",function(){var e=u(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.target,r=n.value.trim(),d.value="",console.log("adding todo?",r),x().then(function(e){var t={userId:1,title:r,completed:!1,localKey:e,saved:!1};fetch(h,{method:"POST",body:JSON.stringify(t),headers:f}).then(function(e){return e.json()}).then(function(t){t.saved=!0,S([t],e),w(t,e)}),S([t]),b(t,e)});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}function x(){return m.apply(this,arguments)}function m(){return(m=u(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return t=e.sent,n=t.transaction("todos"),e.next=6,n.store.index("localKey").count();case 6:return r=e.sent,e.abrupt("return",200+r+1);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(e,t){return g.apply(this,arguments)}function g(){return(g=u(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return r=e.sent,a=r.transaction("todos","readwrite"),a.objectStore("todos").add(t,n),e.next=8,a.done;case 8:console.log("Added a todo to the store",n);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(e,t){return k.apply(this,arguments)}function k(){return(k=u(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return r=e.sent,a=r.transaction("todos","readwrite"),a.objectStore("todos").put(t,n),e.next=8,a.done;case 8:console.log("Added a todo to the store",n);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(e,n){e.forEach(function(e){if(n){var r=document.querySelector('li[data-id="'.concat(n,'"]'));r&&r.remove()}var a='<li data-id="'.concat(n||(e.localKey?e.localKey:e.id),'" ').concat(e.completed?' class="completed"':"",'>\n                <input class="toggle" type="checkbox" ').concat(e.completed?"checked":"",">\n                <label>").concat((0,t.default)(e.title),"</label>\n                <span ").concat(e.saved?' class="saved"':e.localKey?' class="local"':"",'></span>\n                <button class="destroy"></button>\n            </li>');p.insertAdjacentHTML("afterbegin",a)}),p.parentElement.style.display="block"}function R(){p.addEventListener("click",function(){var e=u(regeneratorRuntime.mark(function e(t){var n,r,a,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.target).classList.contains("destroy")){e.next=16;break}return r=n.parentElement,e.next=5,l;case 5:return a=e.sent,o=a.transaction("todos","readwrite"),c=o.objectStore("todos"),e.next=10,c.delete(Number(r.getAttribute("data-id")));case 10:return e.sent,p.removeChild(r),0===p.children.length&&(p.parentElement.style.display="none"),e.next=15,o.done;case 15:console.log("deleted a todo from the store");case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}function j(){return K.apply(this,arguments)}function K(){return(K=u(regeneratorRuntime.mark(function e(){var t,n,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:return t=e.sent,e.prev=3,e.next=6,fetch(h,{method:"GET",headers:f});case 6:return n=e.sent,e.next=9,n.json();case 9:return S(a=e.sent),e.next=13,I();case 13:o=e.sent,a.push.apply(a,r(o)),A(a,t),e.next=22;break;case 18:throw e.prev=18,e.t0=e.catch(3),navigator.onLine||(console.log("offline so loading from indexeddb"),L()),e.t0;case 22:case"end":return e.stop()}},e,null,[[3,18]])}))).apply(this,arguments)}function A(e,t){return E.apply(this,arguments)}function E(){return(E=u(regeneratorRuntime.mark(function e(t,n){var r,a,o,c,s,u,i,d,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return r=e.sent,a=r.transaction("todos","readwrite"),o=a.objectStore("todos"),e.next=7,o.clear();case 7:for(c=!0,s=!1,u=void 0,e.prev=10,i=t[Symbol.iterator]();!(c=(d=i.next()).done);c=!0)p=d.value,(f=p.localKey?p.localKey:p.id)||(f=++n),o.add(p,f);e.next=18;break;case 14:e.prev=14,e.t0=e.catch(10),s=!0,u=e.t0;case 18:e.prev=18,e.prev=19,c||null==i.return||i.return();case 21:if(e.prev=21,!s){e.next=24;break}throw u;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.abrupt("return",a.done);case 27:case"end":return e.stop()}},e,null,[[10,14,18,26],[19,,21,25]])}))).apply(this,arguments)}function I(){return q.apply(this,arguments)}function q(){return(q=u(regeneratorRuntime.mark(function e(){var t,n,r,a,o,c,s,u,d,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,l;case 3:n=e.sent,r=n.transaction("todos"),a=!0,o=!1,e.prev=7,s=i(r.store.index("localKey"));case 9:return e.next=11,s.next();case 11:return u=e.sent,a=u.done,e.next=15,u.value;case 15:if(d=e.sent,a){e.next=24;break}(f=(p=d).value).id||(f.localKey=p.key),t.push(f);case 21:a=!0,e.next=9;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(7),o=!0,c=e.t0;case 30:if(e.prev=30,e.prev=31,a||null==s.return){e.next=35;break}return e.next=35,s.return();case 35:if(e.prev=35,!o){e.next=38;break}throw c;case 38:return e.finish(35);case 39:return e.finish(30);case 40:return S(t),e.abrupt("return",t);case 42:case"end":return e.stop()}},e,null,[[7,26,30,40],[31,,35,39]])}))).apply(this,arguments)}function L(){return O.apply(this,arguments)}function O(){return(O=u(regeneratorRuntime.mark(function e(){var t,n,r,a,o,c,s,u,d,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:t=e.sent,n=t.transaction("todos"),r=[],a=!0,o=!1,e.prev=7,s=i(n.store);case 9:return e.next=11,s.next();case 11:return u=e.sent,a=u.done,e.next=15,u.value;case 15:if(d=e.sent,a){e.next=24;break}(f=(p=d).value).id||(f.localKey=p.key),r.push(f);case 21:a=!0,e.next=9;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(7),o=!0,c=e.t0;case 30:if(e.prev=30,e.prev=31,a||null==s.return){e.next=35;break}return e.next=35,s.return();case 35:if(e.prev=35,!o){e.next=38;break}throw c;case 38:return e.finish(35);case 39:return e.finish(30);case 40:return e.next=43,n.done;case 43:console.log("done"),0!==r.length&&S(r);case 45:case"end":return e.stop()}},e,null,[[7,26,30,40],[31,,35,39]])}))).apply(this,arguments)}y(),R(),j();
},{"idb/with-async-ittr":"nw8M","escape-html":"wN2b"}],"epB2":[function(require,module,exports) {
"use strict";var e=require("./setupServiceWorker"),r=require("./setupIndexedDB");(0,e.setupServiceWorker)(),(0,r.setupIndexedDB)();
},{"./setupServiceWorker":"QGXO","./setupIndexedDB":"uD46"}]},{},["epB2"], null)
//# sourceMappingURL=/pwa-test/main.4b25786d.js.map